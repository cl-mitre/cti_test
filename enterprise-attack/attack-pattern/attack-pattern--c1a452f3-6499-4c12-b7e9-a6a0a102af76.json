{
    "type": "bundle",
    "id": "bundle--7ea61bce-b2d4-4fcc-a3c2-f742e316ca23",
    "spec_version": "2.0",
    "objects": [
        {
            "type": "attack-pattern",
            "id": "attack-pattern--c1a452f3-6499-4c12-b7e9-a6a0a102af76",
            "created_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
            "created": "2018-01-16T16:13:52.465Z",
            "modified": "2018-06-27T14:18:47.700Z",
            "name": "Process Doppelg\u00e4nging",
            "description": "Windows Transactional NTFS (TxF) was introduced in Vista as a method to perform safe file operations. (Citation: Microsoft TxF) To ensure data integrity, TxF enables only one transacted handle to write to a file at a given time. Until the write handle transaction is terminated, all other handles are isolated from the writer and may only read the committed version of the file that existed at the time the handle was opened. (Citation: Microsoft Basic TxF Concepts) To avoid corruption, TxF performs an automatic rollback if the system or application fails during a write transaction. (Citation: Microsoft Where to use TxF)\n\nAlthough deprecated, the TxF application programming interface (API) is still enabled as of Windows 10. (Citation: BlackHat Process Doppelg\u00e4nging Dec 2017)\n\nAdversaries may leverage TxF to a perform a file-less variation of Process Injection Mitigation called Process Doppelg\u00e4nging. Similar to Process Hollowing Mitigation, Process Doppelg\u00e4nging involves replacing the memory of a legitimate process, enabling the veiled execution of malicious code that may evade defenses and detection. Process Doppelg\u00e4nging's use of TxF also avoids the use of highly-monitored API functions such as NtUnmapViewOfSection, VirtualProtectEx, and SetThreadContext. (Citation: BlackHat Process Doppelg\u00e4nging Dec 2017)\n\nProcess Doppelg\u00e4nging is implemented in 4 steps (Citation: BlackHat Process Doppelg\u00e4nging Dec 2017):\n* Transact \u2013 Create a TxF transaction using a legitimate executable then overwrite the file with malicious code. These changes will be isolated and only visible within the context of the transaction.\n* Load \u2013 Create a shared section of memory and load the malicious executable.\n* Rollback \u2013 Undo changes to original executable, effectively removing malicious code from the file system.\n* Animate \u2013 Create a process from the tainted section of memory and initiate execution.",
            "kill_chain_phases": [
                {
                    "phase_name": "defense-evasion",
                    "kill_chain_name": "mitre-attack"
                }
            ],
            "external_references": [
                {
                    "external_id": "T1186",
                    "url": "https://attack.mitre.org/wiki/Technique/T1186",
                    "source_name": "mitre-attack"
                },
                {
                    "url": "https://msdn.microsoft.com/library/windows/desktop/bb968806.aspx",
                    "description": "Microsoft. (n.d.). Transactional NTFS (TxF). Retrieved December 20, 2017.",
                    "source_name": "Microsoft TxF"
                },
                {
                    "url": "https://msdn.microsoft.com/library/windows/desktop/dd979526.aspx",
                    "description": "Microsoft. (n.d.). Basic TxF Concepts. Retrieved December 20, 2017.",
                    "source_name": "Microsoft Basic TxF Concepts"
                },
                {
                    "url": "https://msdn.microsoft.com/library/windows/desktop/aa365738.aspx",
                    "description": "Microsoft. (n.d.). When to Use Transactional NTFS. Retrieved December 20, 2017.",
                    "source_name": "Microsoft Where to use TxF"
                },
                {
                    "url": "https://www.blackhat.com/docs/eu-17/materials/eu-17-Liberman-Lost-In-Transaction-Process-Doppelganging.pdf",
                    "description": "Liberman, T. & Kogan, E. (2017, December 7). Lost in Transaction: Process Doppelg\u00e4nging. Retrieved December 20, 2017.",
                    "source_name": "BlackHat Process Doppelg\u00e4nging Dec 2017"
                },
                {
                    "url": "https://hshrzd.wordpress.com/2017/12/18/process-doppelganging-a-new-way-to-impersonate-a-process/",
                    "description": "hasherezade. (2017, December 18). Process Doppelg\u00e4nging \u2013 a new way to impersonate a process. Retrieved December 20, 2017.",
                    "source_name": "hasherezade Process Doppelg\u00e4nging Dec 2017"
                },
                {
                    "url": "https://msdn.microsoft.com/library/windows/hardware/ff559951.aspx",
                    "description": "Microsoft. (n.d.). PsSetCreateProcessNotifyRoutine routine. Retrieved December 20, 2017.",
                    "source_name": "Microsoft PsSetCreateProcessNotifyRoutine routine"
                }
            ],
            "object_marking_refs": [
                "marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168"
            ],
            "x_mitre_detection": "Windows Transactional NTFS (TxF) was introduced in Vista as a method to perform safe file operations. (Citation: Microsoft TxF) To ensure data integrity, TxF enables only one transacted handle to write to a file at a given time. Until the write handle transaction is terminated, all other handles are isolated from the writer and may only read the committed version of the file that existed at the time the handle was opened. (Citation: Microsoft Basic TxF Concepts) To avoid corruption, TxF performs an automatic rollback if the system or application fails during a write transaction. (Citation: Microsoft Where to use TxF)\n\nAlthough deprecated, the TxF application programming interface (API) is still enabled as of Windows 10. (Citation: BlackHat Process Doppelg\u00e4nging Dec 2017)\n\nAdversaries may leverage TxF to a perform a file-less variation of {{LinkById|T1055}} called Process Doppelg\u00e4nging. Similar to {{LinkById|T1093}}, Process Doppelg\u00e4nging involves replacing the memory of a legitimate process, enabling the veiled execution of malicious code that may evade defenses and detection. Process Doppelg\u00e4nging's use of TxF also avoids the use of highly-monitored API functions such as NtUnmapViewOfSection, VirtualProtectEx, and SetThreadContext. (Citation: BlackHat Process Doppelg\u00e4nging Dec 2017)\n\nProcess Doppelg\u00e4nging is implemented in 4 steps (Citation: BlackHat Process Doppelg\u00e4nging Dec 2017):\n* Transact \u2013 Create a TxF transaction using a legitimate executable then overwrite the file with malicious code. These changes will be isolated and only visible within the context of the transaction.\n* Load \u2013 Create a shared section of memory and load the malicious executable.\n* Rollback \u2013 Undo changes to original executable, effectively removing malicious code from the file system.\n* Animate \u2013 Create a process from the tainted section of memory and initiate execution.",
            "x_mitre_platforms": [
                "Windows"
            ],
            "x_mitre_data_sources": [
                "API monitoring",
                "Process Monitoring"
            ],
            "x_mitre_defense_bypassed": [
                "Process whitelisting",
                "Anti-virus",
                "Whitelisting by file name or path",
                "Signature-based detection"
            ],
            "x_mitre_permissions_required": [
                "User",
                "Administrator",
                "SYSTEM"
            ]
        }
    ]
}